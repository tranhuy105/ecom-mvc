<!DOCTYPE html>
<html lang="en">
<head th:replace="~{fragments :: page_head('Users')}"></head>
<body>
    <div class="container-fluid">
        <div th:replace="~{navigation :: menu}"></div>

        <div>
            <h2>Manage Users</h2>
            <a th:href="@{/users/new}">Create New User</a>
        </div>

        <div>
            <form th:action="@{/users}" class="form-inline m-3">
                <input type="search" th:value="${q}" name="q" class="form-control mb-2" required/>
                &nbsp;&nbsp;
                <input type="submit" value="Search" class="btn btn-primary mb-2" />
                &nbsp;&nbsp;
                <input type="button" value="Clear" id="clearButton" class="btn btn-secondary mb-2"/>
            </form>
        </div>

        <div th:if="${message != null}" class="alert alert-success text-center">
            [[${message}]]
        </div>

        <div class="full-view">
            <table class="table table-bordered table-striped table-hover table-responsive-xl">
                <thead class="thead-dark">
                    <tr>
                        <th>User ID</th>
                        <th>Avatar</th>
                        <th>Email</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Roles</th>
                        <th>Enabled</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="user: ${listUsers}">
                        <td>[[${user.id}]]</td>
                        <td class="text-center">
                            <img th:src="@{${user.avatarPath}}"
                                 alt="avatar"
                                 style="width: 75px; height: 75px; object-fit: cover; border-radius: 25%;"
                            />
                        </td>
                        <td>[[${user.email}]]</td>
                        <td>[[${user.firstName}]]</td>
                        <td>[[${user.lastName}]]</td>
                        <td>[[${user.roles}]]</td>
                        <td>[[${user.enabled}]]</td>
                        <td>
                           <a class="fas fa-edit fa-2x" th:href="@{'/users/edit/' + ${user.id}}" title="Edit this user"></a>
                            &nbsp;
                            <form th:action="@{/users/{id}(id=${user.id})}" method="post" onsubmit="return confirmDelete()" style="display:inline;">
                                <input type="hidden" name="_method" value="delete" />
                                <button type="submit" class="fas fa-trash fa-2x" style="border: none; background: none; color: inherit; cursor: pointer;" title="Delete this user"></button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="mobile-view">
            <div th:each="user : ${listUsers}" class="row m-1">
                <div class="col-3">
                    <img th:src="@{${user.avatarPath}}"
                         alt="avatar"
                         style="width: 75px; height: 75px; object-fit: cover; border-radius: 25%;"
                    />
                </div>
                <div class="col-8">
                    <div>[[${user.email}]]</div>
                     <div>[[${user.roles}]]</div>
                </div>

                <div>&nbsp;</div>
            </div>
        </div>

        <div class="text-center" th:if="${totalItems > 0}">
            <span class="mb-1">Showing users # [[${startCount}]] to [[${endCount}]] of [[${totalItems}]]</span>
            <div class="pt-2">
                <nav>
                    <ul class="pagination justify-content-center">
                        <!-- Previous Button -->
                        <li class="page-item" th:classappend="${currentPage <= 1} ? 'disabled'">
                            <a class="page-link" th:href="@{'/users?page=' + ${currentPage - 1} + ${q != null && q != '' ? '&q=' + q : ''}}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>

                        <!-- First Page Link -->
                        <li class="page-item" th:if="${currentPage > 3}">
                            <a class="page-link" th:href="@{'/users?page=1' + ${q != null && q != '' ? '&q=' + q : ''}}">1</a>
                        </li>

                        <!-- Ellipsis before the current page range if needed -->
                        <li class="page-item disabled" th:if="${currentPage > 3}">
                            <a class="page-link">...</a>
                        </li>

                        <!-- Page Numbers -->
                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(
                            (currentPage <= 2 ? 1 : currentPage - 2),
                            (currentPage >= totalPages - 2 ? totalPages : currentPage + 2))}"
                            th:classappend="${i == currentPage} ? 'active'">
                            <a class="page-link" th:href="@{'/users?page=' + ${i} + ${q != null && q != '' ? '&q=' + q : ''}}">[[${i}]]</a>
                        </li>

                        <!-- Ellipsis after the current page range if needed -->
                        <li class="page-item disabled" th:if="${currentPage < totalPages - 2}">
                            <a class="page-link">...</a>
                        </li>

                        <!-- Last Page Link -->
                        <li class="page-item" th:if="${currentPage < totalPages - 2}">
                            <a class="page-link" th:href="@{'/users?page=' + ${totalPages}}">[[${totalPages}]]</a>
                        </li>

                        <li class="page-item" th:classappend="${currentPage >= totalPages} ? 'disabled'">
                            <a class="page-link" th:href="@{'/users?page=' + ${currentPage + 1} + ${q != null && q != '' ? '&q=' + q : ''}}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <div th:replace="~{navigation :: footer}"></div>
    </div>
</body>
<script type="text/javascript">
    $(document).ready(function() {
        $('#clearButton').on('click', function() {
            $('input[name="q"]').val('');
        });
    });

    function confirmDelete() {
        return confirm("Are you sure you want to delete this user?");
    }
</script>
</html>